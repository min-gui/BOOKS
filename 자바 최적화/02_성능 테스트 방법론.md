


```table-of-contents
```


### 2-1 성능 테스트 종류
---
대부분 부실하게 진행되고, 반쪽 짜리 실험이 될 수 있다. 정량적 질문을 이해하는것이 중요.
애플리케이션 소유자, 고객과 확인하는것이 일반적이다.

- 지연 테스트
	- 사용자가 관심을 갖는 시스템 관찰지표.
	- 고객들이 페이지 로드를 위해 얼마나 기달리고 있는가 ?
	- '자바 가상 머신 성능을 위한 통계' 부분에서 더 자세히 다룰예정.
- 처리량 테스트
	- 지연 테스트 와 이중적인 관계에 있다. 지연테스트 동시 트랜잭션 수를 명확히 제어하는것이 중요. 처리량 테스트는 지연이 관도하게 증가 하지 않도록 주의.
	- 지연 분포가 갑자기 변화하는순간(변곡점)을 찾는것.
- 스트레스 테스트
	- 시스템이 한계치에 도달했을 때 어떻게  반응하고 복구하는지를 확인.
	- 처리량 테스트와 상호 보완 적인 관계
- 용량 계획 테스트
	- 용량 계획 테스트는 비즈니스 목표와 연관 지어 시스템의 장기적인 성능을 관리하고 예측하는 '전략적 활동'
- 성능저하 테스트(부분 실패 테스트)
	- 점진적으로 리소스(CPU, 메모리, 네트워크 대역폭) 제약을 가하여 시스템이 어떻게 성능을 잃어가는지 확인 하는 테스트
	- 카오스 몽키 - 넷플릭스 프로젝트에서 유래
### 2-2 모범 사례 개론
---
- 중요한 요소가 무엇인지 파악, 이것을 측정
- 중요한 것 먼저 최적화
- 가장큰영향 최적화 
	- 즉 중요한 부분 찾고 최적화 해야 한다.

-  탑다운 성능
	- 애플리케이션 전체 성능 동작을 분석하는 접근방식.

-  테스트 환경 생성
	- 우리는 보통 실제 운영과 같은환경에서 테스트를 지향했다.
	- 책에서도 운영테스트와 비슷하게 구축하기를 지향한다. 요즘엔 클라우드 환경으로 테스트 환경을 보다 손쉽게 구성 할 수 있다.
- 성능 요구사항 식별
	- 비기능 요구 사향 (NFRs) : 관찰 가능한 지표
	- 누구나 쉽게 이해해야 합니다.
		- 95% 기준 트랜잭션 시간 을 100ms 줄이기
		- 현재 하드웨어로 처리량을 5배 높이기
		- 지연시간 10밀리초 단축해 고객 이탈 비율 줄이기
- 소프트웨어 개발 수명 주기와 성능 테스트
	- 성능 저하 테스트를 소프트웨어 개발 수명주기의 중요한 부분으로 인식하고 지속적으로 수행.
- 자바 특유의 문제들
	- 메모리 역역의 동적 튜닝과 JIT 컴파일이 대표적.
	- 자바 가상머신은 메서드를 분석해 JIT컴파일 후보를 자동으로 선정, JIT 컴파일에 대상이 되지 않는경우 는 아래일 것이다.
		- 메서드가 자주 실행 되지 않는다.
		- 메서드가 너무 크거나 복잡하여 컴파일을 위한 분석이 불가능하다.(전자 보달 덜 발생)

### 2-3 성능 안티 패턴의 원인
---
- 반짝이는 것에 한눈팔기
- 입에서 입으로 전해지는 방식으로 조정하기.
- 개발자 들이 잘못 결정을 내리는 5가지

- 지루함
	- Collections.sort()처럼 간단한 기능으로 충분한 경우에도 직접 정렬 알고리즘을 작성하는 식.
- 이력 부풀리기
	- 과도한 기술 사용 이력서 추가를위한. cc. 공부하고 알고는 있되 기술 사용은 신중하게 필요한 기술만 사용하자.
- 사회적 압박
	- 개발속도를 중시하는 분위기에서 발생가능성이 높다.
- 이해 부족
	- 도입기술의 이해부족 예를들어 하이버네이트를 충분히 이해하지 않고 사용하는건 시스템의 복잡성을 더한다.
- 문제에 대한 오해 또는 문제 자체의 부제
	- 문제 자체를 제대로 파악하지 않은 상태에서 해결책이 제시되는 경우가 있다. 불확실한 점이 있으면 프로토 타입으로 검증 필요하다.


### 2.4 자바 가상 머신 성능을 위한 통계
---

-  오차를 최소화 하기위해 테스트 하고, 통계적으로 유의미한 결과 얻기위해서는 최소 30번의 테스트 필요.

#### 2.4.1 오차유형
- 무작위 오차 
	- 운영에서만 발생한다고 본다. 가우스 분포를 따른다고 본다. 가우스 분포란? 예) 시험 점수가 평균 70점, 표준편차 10점인 정규분포를 따른다면, 대부분의 학생 점수는 60~80점 사이에 몰려 있을 가능성 높다.
	- 서로 연관이 없는 다양한 요인이 결과에 영향을 미치는 경우
- 체계적 오차
	- 특정 요인이 지속적으로 영향을 미치는 경우
	- 선형 패턴, 리소스가 서서히 소진 되는걸 볼 수 있다.

#### 2.4.2 비정규 통계
- 비정규 분포에서는 많은 규칙이 적용 되지 않는다.
- HrdHistogram 시각적인 통계 툴
	- 평균 응답 시간이 20ms라 해도, 실제로는
	    - 90%는 10ms 이하
	    - 1%는 500ms
	- 평균만 보면 시스템이 안정적인 것 같지만, 실제 사용자 1%는 **매우 나쁜 경험**을 하고 있는걸 자세히 보여주는 툴
	- 조정된 누락을 감지하고 이해하는데 도움을 준다.

### 2.5 통계 해석
---
#### 2.5.1 거짓 상관관계
- 모유 수유를 하면 IQ 가 일반적으로 높다 라는 연구결과, 실제로 모유수유를 하는 집단은 사회경제적 수준이 높은경우가 많으며 , 이에 아이 정신건강 발달을 위해 더많은 시간을 투자할 가능성이 높다.
- 특정한 연결이 그럴듣해 보인다고 해서 속단하면 안된다. cc. 데이터를 보고도 다른 문제사항이 없는지 검토하고 의심해야 한다.
#### 2.5.2 모자와 코끼리
- 200에러, 400에러 ,500에러의 분포도는 서로 다르다 500에러는 요청이 많을수록 지연시간이 길어지고, 400에러는 즉시 응답이 가능한 경우가 많다 . 이런 경우 에러를 모아 보면 코끼리를 집어 삼킨 보아뱀 형태가 된다.
- 여러 방면의 데이터 , 비즈니스 로직을 분석하여 광범위 하게 살펴보는봐 데이터 왜곡을 최대한 줄이는것이 중요하다.


### 2.6 인지적 편향과 성능 테스트
---
- 확증편향, 최신성 편향 조심해야한다.

#### 2.6.1 환원주의적 사고편향
- 충분히 작은 부분으로 나눠 각부분을 이해하면 전체 시스템을 파악할 수 있다는 접근법.
- 하지만 복잡한 시스템에서는 이관점이 성립되지 않는다. cc. 전체적인 틀을 보고 접근해야 한다는건가 ?


#### 2.6.2 확증편향
- 믿고 싶어 하는 것만 믿는다.
- NoSQL 을 도입할려고 한다고 가정, 전체 스키마로 하기엔 복잡하다는 이유로 실제 데이터와 유사하지 않게 테스트 그결과 운영까지 도입. 잘못된 패턴.

#### 2.6.3 혼란 속의 행동 편향
- 예상되지 않은 상황에서 장애가 났을때 나타난다.
- 문제 해결 접근 방식을 체계적으로 관리 하지 않으면, 인간적인 요소가 영향을 미칠수 있다.
	- cc. 어떤 문제 해결 접근 방식이 있는지 알아보자.
	- 1.탐지 2.진단(APM 도구,ELK 도구) , 대응(트레픽우회, Auto Scailing), 예방

#### 2.6.4 위험 편향
- 사람은 본래 위험을 회피하고, 변화에 저항하는 경향이 있다.
- cc. 이런상황을 벗어나려면 어떻게 하지 ? 
	- 데이터 기반으로 생각
	- Postmortem 문화 : 장애/실패 후 책임 추궁보다 원인 분석과 개선 방안에 집중 → “위험을 드러내도 안전하다”는 신호 제공.
	- 테스트를 자주 하는것이 중요한거 같다.

#### 요약
- 주관적 사고에 빠지지 않기.
- 정규 분포 모델에 의존하여 통계적 오류에 빠지지 않기.